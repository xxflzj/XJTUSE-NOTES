[TOC]

#  [XJTU计算机网络安全与管理]——第11讲 安全应用及协议（二）

## 一、SSL

Secure socket layer,是Netscape提出的。 

TLS（Transport Layer Security） 1.0 （RFC 2246） =SSLv3.l。 

设计目标是在<mark>TCP基础上</mark>提供一种可靠的端到端的安全服务，其服务对象一般是WEB应用。 

<mark>传输层的安全协议</mark>——考点

TLS实际上是对SSL的最新改进，并由IETF进行了标准化。

<mark>基于SSL的http协议称为https协议</mark>——考点

### SSL的体系结构

<img src="https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220531103420946.png" alt="image-20220531103420946" style="zoom:50%;" />



### SSL连接与会话

**SSL连接（connection)**

> 一个连接是一个提供一种合适类型服务的传输；
>
> SSL的连接是点对点的关系；
>
> 连接是暂时的，每一个连接和一个会话关联。

**SSL会话（session）**

> 一个SSL会话是在客户与服务器之间的一个关联；
>
> 会话由Handshake Protocol创建。会话定义了一组可供多个连接共享的加密安全参数；
>
> 会话用以避免为每一个连接提供新的安全参数所需昂贵的谈判代价。

### SSL记录协议——重要

SSL 记录协议为SSL连接提供两种服务

> **保密性**。利用握手协议所定义的共享密钥对**SSL净荷（payload）**加密 。
>
> **完整性**。利用握手协议所定义的共享的MAC密值来生成报文的鉴别码（MAC）。 

### SSL工作过程和SSL记录格式——考点（记住流程）

:one: 分片

:two: 压缩

:three: 添加MAC

:four: 加密

:five: 添加SSL头

![SSL工作过程](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220613222844952.png)

### SSL握手协议层

#### :one: 加密规约修改协议 

> 仅定义了一个由单个字节“1”构成的消息报文； 
>
> 该消息将改变了连接所使用的加密规约。 

#### :two: 告警协议 

> 用于将SSL有关的告警传送给对方实体； 
>
> 分为警告性告警（warning）或致命性告警（fatal）两个级别

#### :three: 握手协议（SSL Handshake Protocol）

是SSL中最复杂的一个部分。

其功能是使服务器和客户能够相互鉴别对方的身份，并且协商一系列安全参数。 

这些安全参数包括用于加密和MAC算法，以及用于在SSL记录中保护发送数据的加密密钥。 

##### 握手过程

<mark>**传输会话密钥可以通过证书，也可以通过密钥协商**</mark>

- 第一阶段 建立安全能力 包括协议版本 会话Id 密码构件 压缩方法和初始随机数
- 第二阶段 服务器发送证书 密钥交换数据和证书请求，最后发送请求-相应阶段的结束信号
- 第三阶段 如果有证书请求客户端发送此证书 之后客户端发送密钥交换数据 也可以发送证书验证消息
- 第四阶段 变更密码构件和结束握手协议

## 二、SSH

telnet和ftp协议中存在不少安全问题：明文传输，口令泄露等

SSH是用来进行<mark>安全远程登录和文件传输</mark>的软件，由厂商提出，被IETF采用有SSH1和SSH2两个版本

为用户提供强认证及数据加密等功能，取代传统的telnet，rlogin，rsh等。<mark>**SSH2中还增加了SFTP**</mark>，此外，还支持安全X连接，并安全转发任意TCP连接

### 基本架构

:one: **传输层协议**（The Transport Layer Protocol）：传输层协议提供[服务器](http://zh.wikipedia.org/wiki/服务器)认证，数据机密性，信息完整性等的支持。

:two: **用户认证协议**（The User Authentication Protocol）：用户认证协议为服务器提供客户端的身份鉴别。 

:three: **连接协议**（The Connection Protocol）：连接协议将加密的信息隧道复用成若干个逻辑通道，提供给更高层的应用协议使用。

:four: 同时还有为许多高层的网络安全应用协议提供扩展的支持。

#### 传输协议

运行于TCP/IP之上，对传输的数据进行加密、服务器认证及完整性保护。

协议包包括

> 长度：不包括MAC的长度及包长度自身
>
> 填充数据，任意单大于4且为加密数据块长度倍数
>
> 负载
>
> MAC

#### 认证协议

包括主机认证和用户认证

**主机认证**

> 可使用UNIX中文件
>
> 信任模型：基于共享密钥；给予证书

**用户认证**

> 可实际与主机的也可是基于用户名的

#### 连接协议

运行于前两协议之上

方式

> 发送消息
>
> 应答
>
> 成功后所有通信都是加密的

## 三、安全电子交易 (SET)

Security Electronic Transaction。

主要是为了解决用户、商家和银行之间通过信用卡支付的交易而设计的，以保证支付信息的机密和支付过程的完整。

SET中的核心技术包括**公开密钥加密、数字签名、电子信封、电子安全证书等**。 

是一个安全协议的集合。 

### 设计目标

为支付/订购信息提供机密性。 

通信信息的完整性。

鉴证持卡者是否是信用卡账户的合法用户。

持卡用户需要确认能与之进行安全交易的商家的身份。

采用最好的安全策略和系统设计技术来保护电子商务交易中的所有合法方。

**安全性应不依赖于传运输层安全机制，但又可以充分利用传输层的安全服务。**

协议应该独立于硬件平台、操作系统和WEB软件。

### 交易过程

![image-20220614164154609](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614164154609.png)



1.申领信用卡。

2.持卡用户获得证书。

3.商家获得证书。

4.持卡用户订购商品。

5.用户对商家的身份认证。

6.用户发送订购和支付信息。

7.商家请求支付认可。

8.商家确认订购。

9.供货。

10.商家请求支付。

### 双向签名——考点 

持卡用户需要将订购信息（OI）和支付信息（PI）一起发送给商家。

但是实际上订购信息是发送给商家的，而支付信息是需要发送给银行系统的。为了向持卡用户提供更好的隐私保护，SET将OI和PI分离开来，由不同的机构处理。 

**简单地将OI和PI分离是不行的。这两个方面的信息也必须采用某种必要的方式连接起来，以解决可能出现的争端。** 

**双向签名可以连接两个发送给不同接收者的消息报文 ，可以满足这种需求。**

![image-20220614164320973](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614164320973.png)

K~Rc~：私钥签名



![image-20220614165451899](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614165451899.png)



![image-20220614165459236](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614165459236.png)

## 四、IP安全——IPSec

前身：IPSP（IP Security Protocol）。

IETF中的IP Security Protocol Working Group工作组负责标准化，目标：

> 该体制不仅适用于IP目前的版本（IPv4）,也能在IP的新版本（IPng或IPv6）下工作；
>
> 可为运行于IP顶部的任何一种协议提供保护；
>
> 与加密算法无关，即使加密算法改变了或增加新的算法，也不对其他部分的实现产生影响；
>
> 必须能实现多种安全策略，但要避免给不使用该体制的人造成不利影响。

### IPSec初始文档集

<mark>两个重要协议：AH和ESP</mark>

| RFC编号 | RFC名称                                          | 现状          |
| ------- | ------------------------------------------------ | ------------- |
| 1825    | Security  Architecture for the Internet Protocol | 被RFC2401取代 |
| 1826    | IP  Authentication Header（AH）                  | 被RFC2402取代 |
| 18211   | IP  Encapsulating Security Payload (ESP)         | 被RFC2406取代 |
| 1828    | IP  Authentication using Keyed MD5               | 有效          |
| 1829    | The  ESP DES-CBC Transform                       | 有效          |

### IPSec提供的安全机制

:one: 鉴别：保证收到的数据包的确是由数据包头所标识的数据源发来的，且数据包在传输过程中未被篡改。

:two: 保密性：保证数据在传输期间不被未授权的第三方窥视。

:three: 密钥管理 ：解决密钥的安全交换。 

|                | AH   | ESP(只加密) | ESP(加密并鉴别) |
| -------------- | ---- | ----------- | --------------- |
| 访问控制服务   | Y    | Y           | Y               |
| 无连接完整性   | Y    | -           | Y               |
| 数据源鉴别     | Y    | -           | Y               |
| 拒绝重放的分组 | Y    | Y           | Y               |
| 保密性         | -    | Y           | Y               |
| 流量保密性     | -    | Y           | Y               |

### IPSec的典型用途

保证因特网上各分支办公点的安全连接。 

保证因特网上远程访问的安全。 

通过外部网或内部网建立与合作伙伴的联系。 

提高了电子商务的安全性。 

<mark>VPN</mark>

### IPSec的工作模式——考点

传输模式：传输模式保护的是IP载荷。 

隧道模式 ：隧道模式保护的是整个IP包。 

![image-20220614170125864](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614170125864.png)



### IPSec的实施位置

端主机和路由器

### 鉴别首部（AH） 

为IP提供数据完整性：防止传输过程中对数据包内容的修改。 

数据源身份验证（鉴别）：防止地址欺骗攻击。

一些有限的抗重播服务 ：防止消息重放攻击。 

不保证任何的机密性 

#### 抗重放

使用序列号和滑动窗口来抗重放

#### 完整性校验值ICV

<mark>使用HMAC</mark>

由MAC算法产生的消息鉴别码或截短的消息鉴别码组成

> HMAC-MD5-96；
>
> HMAC-SHA-1-96。 

用HMAC求MAC时算法的输入如下：

> IP数据包头：只包括在传输期间不变的字段或接受方可预测的字段，其余不定的字段全置为0；
>
> AH：除“鉴别数据”字段外其他的所有字段，“鉴别数据”字段被置为0；
>
> IP数据包中的所有的上层协议数据

#### 传输模式和隧道模式的AH数据包格式——要会画

![image-20220614170817346](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614170817346.png)

#### 封装安全载荷（ESP） 

提供加密和鉴别

#### 传输模式和隧道模式的ESP数据包格格式——会画

![image-20220614170927478](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220614170927478.png)

#### 安全关联SA

<mark>单向的！双向的话要使用两个SA</mark>

安全关联SA是指由IPSec提供安全服务的数据流的发送者到接收者的一个单向逻辑关系，用来表示IPSec如何为SA所承载的数据通信提供安全服务。

其方式是使用AH或ESP之一，**一个SA不能同时使用AH和ESP两种保护措施**。 

SA决定两个主机间通信的安全特征。 

#### 安全关联数据库SAD——知道中英文

Security Association Database。

SAD中的元组用于定义与每个SA相关联的参数值 ，如：

序列号、序列号溢出标记 、抗重播窗口 、AH信息 、ESP信息 、SA的有效期 、IPSec协议工作模式 、路径最大传输单元MTU。 

#### 安全策略数据库SPD——知道中英文

Security Policy Database。

人机间的安全接口 ，包括：

要保护什么样的通信数据（被保护对象）；

由谁来实行保护（实施保护者）；

采用何种手段如何保护通信数据（处理方法）。 

## 五、因特网密钥交换

### Diffie-Hellman协议 

优点：

> 密钥仅在需要时才被建立，不需要将密钥存储很长一段时间，因此不易受到攻击，降低了密钥泄漏的危险性；
>
> 协议除要求有预先协商好的全局参数外，不要求有其他预先已存在的基础设施，实现简单方便。

缺点：

> **协议未提供有关通信双方身份的任何信息**。
>
> **易受中间人攻击**。即第三方C在和A通信时扮演B；而在和B通信时扮演A。A和B都同C协商了一个密钥，然后C就可以监听和修改通信数据流，而A和B毫不知情，都以为是在和对方通信。
>
> **协议的计算量很大，因此易受到阻塞性攻击。**

## 参考资料

[1] 西安交通大学计算机网络安全与管理2022年春PPT 	田暄

[2] 密码编码学与网络安全（第七版），William Stallings著，王后珍等译

